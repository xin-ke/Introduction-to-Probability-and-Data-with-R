---
title: "Exploring the BRFSS data"
output: 
  html_document: 
    fig_height: 4
    highlight: pygments
    theme: spacelab
---
## Setup

### Load packages

```{r load-packages, message = FALSE}
library(ggplot2)
library(dplyr)
library(ggrepel)
library(forcats)
```

### Load data

```{r load-data}
load("brfss2013.RData")
```


* * *

## Part 1: Data
**The observations in the sample are collected from randomly selected people who are over the age of 18 and live in the United States via either a landline telephone or cellphone call. Since the data is collected from a random sample the findings are generalizeable to the adult population residing in the United States who have access to a landline or cellphone. Causality cannot be determined as there is no random assignment used.**


* * *

## Part 2: Research questions

**Research question 1: After controlling for the presence of medical insurance, are there regional differences in the percentage of the populace who have received a wellness checkup within the last 2 years? ** 

**Research question 2: Does the self-reported physical health of the population vary by region?**

**Research question 3:**


* * *

## Part 3: Exploratory data analysis


**Research question 1:**

```{r}
insurance_exams <- brfss2013 %>%
  filter(!is.na(checkup1) & !is.na(hlthpln1)) %>%
  group_by(hlthpln1, X_state, checkup1) %>%
  summarise(count = n())

insured_by_state <- insurance_exams %>% 
  group_by(X_state, hlthpln1) %>%
  summarise(num_insured = sum(count))

percentage_insured <- insured_by_state %>%
  group_by(X_state) %>%
  mutate(percent_insured = prop.table(num_insured) * 100) %>%
  filter(hlthpln1 == "Yes")

exams_by_state <- insurance_exams %>%
  group_by(X_state, checkup1) %>%
  mutate(checkup_recently = ifelse(checkup1 == "Within past year" | checkup1 == "Within past 2 years", "yes", "no")) %>%
  group_by(X_state, checkup_recently) %>%
  summarise(sum_recent_exam = sum(count))

percentage_exam <- exams_by_state %>%
  group_by(X_state) %>%
  mutate(percent_exam = prop.table(sum_recent_exam) * 100) %>%
  filter(checkup_recently == "yes")

ungroup(percentage_exam) %>%
  mutate(X_state = fct_reorder(X_state, percent_exam)) %>%
  ggplot( aes(x = X_state, y = percent_exam, fill = percent_exam)) + 
    geom_bar(stat = "identity", width = 0.5) + 
    coord_flip() +
    theme_minimal()

ggplot(percentage_exam, aes(x = percent_exam)) +
  geom_boxplot() +
  geom_dotplot(stackdir = 'center', binwidth = 1, method = "histodot")

yes_percentages <- merge(percentage_exam, percentage_insured, by = "X_state")

ggplot(yes_percentages, aes(x = percent_insured, y = percent_exam, label = X_state)) + geom_point(color = "green") + geom_text_repel(aes(label = X_state),
                 point.padding = NA,
                 size = 2.5)

```



**Research question 2:**

```{r}
phys_hlth_ins <-brfss2013 %>%
  filter(!is.na(physhlth) & !is.na(hlthpln1) & !is.na(checkup1)) %>%
  mutate(checkup_recently = ifelse(checkup1 == "Within past year" | checkup1 == "Within past 2 years", "yes", "no"))


phys_health <- phys_hlth_ins %>%
  group_by(physhlth) %>%
  summarise(count = n())

ggplot(phys_health, aes(x = physhlth, y = count)) + 
    geom_bar(stat = "identity", width = 0.75) 

bad_health <- phys_health %>%
  filter(physhlth != 0)

ggplot(bad_health, aes(x = physhlth, y = count)) +
  geom_bar(stat = "identity", width = 0.75)

phys_ins_counts <- phys_hlth_ins %>% 
  group_by(hlthpln1, physhlth) %>%
  summarise(count = n())

phys_hlth_ins %>%
  filter(physhlth != 0) %>%
  ggplot(aes(x = hlthpln1, y = physhlth)) +
  geom_violin()

phys_hlth_ins %>%
  filter(physhlth != 0) %>%
  ggplot(aes(x = checkup_recently, y = physhlth)) +
  geom_violin()
```



**Research question 3:**

```{r}

```

